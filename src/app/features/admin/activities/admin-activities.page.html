<div class="space-y-6">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <div>
      <h2 class="text-3xl font-display font-bold text-secondary dark:text-white mb-2">Aktiviteter</h2>
      <p class="text-slate-600 dark:text-slate-400">Administrer alle aktiviteter</p>
    </div>
    <button
      (click)="showCreateForm.set(true)"
      class="bg-primary hover:bg-amber-600 text-white px-5 py-2 rounded-full text-sm font-bold transition-colors flex items-center gap-2"
    >
      <span class="material-icons-round text-sm">add</span>
      Ny aktivitet
    </button>
  </div>

  <!-- Error Message -->
  @if(service.error()) {
    <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4">
      <p class="text-red-600 dark:text-red-400 text-sm font-medium">{{service.error()}}</p>
    </div>
  }

  <!-- Create/Edit Form -->
  @if(showCreateForm() || editingActivity()) {
    <app-admin-activities-form
      [activity]="editingActivity()"
      [activityTypes]="activityTypes()"
      (submit)="onFormSubmit($event)"
      (cancel)="cancelEdit()"
    ></app-admin-activities-form>
  }

  <!-- Loading State -->
  @if(service.loading()) {
    <div class="text-center py-12">
      <p class="text-slate-600 dark:text-slate-400">Indlæser...</p>
    </div>
  }

  <!-- Activities List -->
  @if(!service.loading() && service.activities().length > 0) {
    <div class="space-y-4">
      @for(activity of service.activities(); track activity.id) {
        <div class="bg-slate-50 dark:bg-slate-800/50 p-8 rounded-[2rem] border border-slate-200 dark:border-slate-700">
          <div class="flex items-start justify-between gap-4">
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-3 flex-wrap">
                <h3 class="text-2xl font-display font-bold text-slate-900 dark:text-white">{{activity.title}}</h3>
                @if(!activity.is_active) {
                  <span class="bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 px-3 py-1 rounded-full text-[10px] uppercase font-bold">
                    Inaktiv
                  </span>
                }
                @if(activity.repeat_badge) {
                  <span class="bg-slate-100 dark:bg-slate-700 px-3 py-1 rounded-full text-[10px] uppercase font-bold text-slate-500 dark:text-slate-300">
                    {{getRepeatBadgeText(activity.repeat_badge)}}
                  </span>
                }
              </div>
              
              @if(activity.description) {
                <p class="text-slate-600 dark:text-slate-400 leading-relaxed mb-4">
                  {{activity.description}}
                </p>
              }

              <div class="flex flex-wrap gap-4 text-sm text-slate-600 dark:text-slate-400">
                <span><strong>Type:</strong> {{getActivityTypeLabel(activity.activity_type_id)}}</span>
                @if(activity.date) {
                  <span><strong>Dato:</strong> {{formatDate(activity.date)}}</span>
                }
                @if(activity.weekday !== undefined && activity.weekday !== null) {
                  <span><strong>Ugedag:</strong> {{getWeekdayName(activity.weekday)}}</span>
                }
                @if(activity.start_time) {
                  <span><strong>Tid:</strong> {{formatTime(activity.start_time)}}@if(activity.end_time) { - {{formatTime(activity.end_time)}}}</span>
                }
                @if(activity.location) {
                  <span><strong>Lokation:</strong> {{activity.location}}</span>
                }
              </div>
            </div>

            <div class="flex gap-2 shrink-0">
              <button
                (click)="startEdit(activity)"
                class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors"
              >
                Rediger
              </button>
              <button
                (click)="openDeleteConfirm(activity.id, activity.title)"
                class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors"
              >
                Slet
              </button>
            </div>
          </div>
        </div>
      }
    </div>
  }

  <!-- Empty State -->
  @if(!service.loading() && service.activities().length === 0) {
    <div class="bg-white dark:bg-slate-900 rounded-[2rem] p-12 border border-slate-100 dark:border-slate-800 text-center">
      <p class="text-slate-600 dark:text-slate-400">Ingen aktiviteter endnu</p>
    </div>
  }

  <!-- Delete Confirmation Modal -->
  @if(showDeleteConfirm()) {
    <div 
      class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"
      (click)="closeDeleteConfirm()"
      role="dialog"
      aria-modal="true"
      aria-labelledby="delete-activity-dialog-title"
      aria-describedby="delete-activity-dialog-description"
    >
      <div 
        class="bg-white dark:bg-slate-900 rounded-[2rem] p-8 max-w-md w-full border border-slate-200 dark:border-slate-700 shadow-2xl"
        (click)="$event.stopPropagation()"
      >
        <div class="text-center space-y-6">
          <span class="material-icons-round text-red-500 text-6xl">warning</span>
          <h3 id="delete-activity-dialog-title" class="text-2xl font-display font-bold text-secondary dark:text-white">
            Slet aktivitet?
          </h3>
          <p id="delete-activity-dialog-description" class="text-slate-600 dark:text-slate-400">
            Er du sikker på, at du vil slette aktiviteten 
            <strong>{{activityToDelete()?.title}}</strong>? Denne handling kan ikke fortrydes.
          </p>
          <div class="flex justify-center gap-4 pt-4">
            <button
              (click)="closeDeleteConfirm()"
              [disabled]="deleting()"
              class="bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 px-6 py-3 rounded-full text-sm font-bold transition-colors"
            >
              Annuller
            </button>
            <button
              (click)="confirmDelete()"
              [disabled]="deleting()"
              class="bg-red-500 hover:bg-red-600 disabled:bg-red-300 disabled:cursor-not-allowed text-white px-6 py-3 rounded-full text-sm font-bold transition-colors flex items-center gap-2"
            >
              @if(deleting()) {
                <span class="material-icons-round animate-spin">hourglass_empty</span>
                Sletter...
              } @else {
                <span class="material-icons-round">delete_forever</span>
                Slet permanent
              }
            </button>
          </div>
        </div>
      </div>
    </div>
  }
</div>
